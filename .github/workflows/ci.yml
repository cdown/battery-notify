_setup: &setup
  - uses: actions/checkout@v3
  - uses: dtolnay/rust-toolchain@stable
  - uses: swatinem/rust-cache@v2

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo build

  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo test

  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo fmt --all -- --check
      - run: cargo clippy -- -D warnings

  build_nf:
    name: Build (no features)
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo build --no-default-features

  test_nf:
    name: Test (no features)
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo test --no-default-features

  lint_nf:
    name: Lint (no features)
    runs-on: ubuntu-latest
    steps:
      - *setup
      - run: cargo clippy --no-default-features -- -D warnings

on:
  push:
  pull_request:
  workflow_dispatch:
